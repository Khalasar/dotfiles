#!/bin/bash

ARCH=$(uname -m)
ARCH_CMD=linux64

uid=$(id -u)
gid=$(id -g)

case $1 in
  bash|shell)
    shift
    command="bash"
    ;;
  make)
    shift
    command="make"
    ;;
  *)
    command="crystal"
    ;;
esac

echo "$command $@"

docker run \
    --rm \
    -it \
    -u $uid:$gid \
    -v $(pwd):/mnt \
    -w /mnt \
    -e LIBRARY_PATH="/opt/crystal/embedded/lib/" \
    -e CRYSTAL_CONFIG_VERSION="ci" \
    "jhass/crystal-build-$ARCH" \
    "$ARCH_CMD" $command $@
